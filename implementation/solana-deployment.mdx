---
title: "Solana Program Deployment (Devnet)"
description: "Complete guide for deploying AetherLock Anchor programs to Solana Devnet"
---

# Solana Program Deployment Guide (Devnet)

<Warning>
**Devnet Deployment Only**: This guide covers deployment to Solana Devnet. AetherLock is currently in development and not yet deployed to mainnet. Mainnet deployment will be available in a future release.
</Warning>

This guide covers the complete process of building, testing, and deploying the AetherLock Solana program using the Anchor framework to Solana Devnet.

## Prerequisites

Ensure you have completed the [Quick Start Guide](/implementation/quick-start) and have the following installed:

- Solana CLI (v1.16.0+)
- Anchor Framework (v0.29.0+)
- Rust (v1.70.0+)
- Node.js (v18.0.0+)

## Project Structure

The Solana program is organized as follows:

```
solana-program/
├── Anchor.toml              # Anchor configuration
├── Cargo.toml              # Rust workspace configuration
├── package.json            # Node.js dependencies
├── programs/
│   └── aetherlock/
│       ├── Cargo.toml      # Program dependencies
│       └── src/
│           ├── lib.rs      # Main program entry point
│           ├── instructions/  # Instruction handlers
│           ├── state/      # Account state definitions
│           └── errors.rs   # Custom error definitions
├── tests/                  # Integration tests
├── target/                 # Build artifacts
└── migrations/             # Deployment scripts
```

## Configuration Setup

### 1. Configure Anchor.toml

Edit `solana-program/Anchor.toml` to set up your devnet deployment configuration:

```toml
[features]
seeds = false
skip-lint = false

[programs.localnet]
aetherlock = "AEth1ockDevXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

[programs.devnet]
aetherlock = "AEth1ockDevXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

[registry]
url = "https://api.apr.dev"

[provider]
cluster = "devnet"
wallet = "~/.config/solana/id.json"

[scripts]
test = "yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/**/*.ts"

[test]
startup_wait = 5000
shutdown_wait = 2000
upgradeable = true

[[test.genesis]]
address = "metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"
program = "spl_token_metadata.so"

[test.validator]
url = "https://api.devnet.solana.com"
ledger = ".anchor/test-ledger"
rpc_port = 8899
bind_address = "0.0.0.0"
```

<Note>
**Devnet Program ID**: Replace `AEth1ockDevXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX` with your actual devnet program ID after deployment.
</Note>

### 2. Configure Solana CLI

Set up your Solana CLI for devnet deployment:

```bash
# Configure for devnet deployment
solana config set --url devnet
solana config set --keypair ~/.config/solana/id.json

# Verify configuration
solana config get
```

### 3. Generate Program Keypair

Generate a new keypair for your program (or use existing):

```bash
cd solana-program

# Generate new program keypair
solana-keygen new --outfile target/deploy/aetherlock-keypair.json

# Get the program ID
solana-keygen pubkey target/deploy/aetherlock-keypair.json
```

Update the program ID in:
- `Anchor.toml` (programs section)
- `programs/aetherlock/src/lib.rs` (declare_id! macro)

## Build Process

### 1. Clean Previous Builds

```bash
cd solana-program

# Clean Anchor build artifacts
anchor clean

# Clean Cargo build artifacts
cargo clean
```

### 2. Build the Program

```bash
# Build the program
anchor build

# Verify build succeeded
ls -la target/deploy/
```

Expected output files:
- `aetherlock.so` - The compiled program binary
- `aetherlock-keypair.json` - Program keypair
- `idl/aetherlock.json` - Interface Definition Language file

### 3. Generate TypeScript Client

```bash
# Generate TypeScript client code
anchor build --typescript

# Install generated client dependencies
npm install
```

## Testing

### 1. Run Unit Tests

```bash
# Run Rust unit tests
cargo test

# Run with verbose output
cargo test -- --nocapture
```

### 2. Run Integration Tests

```bash
# Start local validator (in separate terminal)
solana-test-validator --reset --quiet

# Run Anchor tests
anchor test --skip-local-validator

# Or run tests with local validator startup
anchor test
```

### 3. Test Specific Functions

```bash
# Run specific test file
anchor test --skip-local-validator tests/escrow.ts

# Run with debugging
DEBUG=* anchor test --skip-local-validator
```

## Deployment to Devnet

### 1. Prepare for Deployment

#### Check Account Balance

```bash
# Check SOL balance (need ~5-10 SOL for deployment)
solana balance

# Airdrop SOL on devnet if needed
solana airdrop 10

# If airdrop fails, try smaller amounts
solana airdrop 2
```

<Note>
**Devnet Airdrops**: Devnet airdrops are rate-limited. If you encounter issues, try requesting smaller amounts or use a devnet faucet like https://solfaucet.com
</Note>

#### Verify Program Size

```bash
# Check program size (max 1MB for non-upgradeable, 10MB for upgradeable)
ls -lh target/deploy/aetherlock.so

# If too large, optimize build
cargo build-bpf --release
```

### 2. Deploy to Devnet

```bash
# Ensure cluster is set to devnet
solana config set --url devnet

# Deploy the program
anchor deploy --provider.cluster devnet

# Verify deployment
solana program show <PROGRAM_ID>
```

<Info>
**Deployment Time**: Initial deployment typically takes 2-5 minutes depending on program size and network conditions.
</Info>

## Program ID Configuration

### 1. Update Program References

After devnet deployment, update the program ID in all relevant files:

#### Update Anchor.toml
```toml
[programs.devnet]
aetherlock = "YourActualDevnetProgramIDHere"
```

#### Update lib.rs
```rust
use anchor_lang::prelude::*;

declare_id!("YourActualDevnetProgramIDHere");

#[program]
pub mod aetherlock {
    use super::*;
    // ... program implementation
}
```

#### Update Client Code
```typescript
// In your frontend/backend code
export const AETHERLOCK_PROGRAM_ID_DEVNET = new PublicKey(
  "YourActualDevnetProgramIDHere"
);
```

<Warning>
**Environment-Specific IDs**: Ensure your client code uses the correct program ID for devnet. Do not use devnet program IDs in production environments.
</Warning>

### 2. Regenerate Client Code

```bash
# Rebuild with new program ID
anchor build

# Update TypeScript bindings
npm run build
```

## Verification Steps

### 1. Verify Program Deployment

```bash
# Check program account
solana program show <PROGRAM_ID>

# Check program logs
solana logs <PROGRAM_ID>

# Verify program is executable
solana program dump <PROGRAM_ID> program_dump.so
```

### 2. Test Program Instructions

```bash
# Run post-deployment tests
anchor test --skip-build --skip-deploy

# Test specific instruction
node scripts/test-create-escrow.js
```

### 3. Verify IDL Upload

```bash
# Check if IDL is uploaded to Anchor registry
anchor idl fetch <PROGRAM_ID>

# Upload IDL if not present
anchor idl init <PROGRAM_ID> --filepath target/idl/aetherlock.json
```

## Upgrades and Maintenance on Devnet

### 1. Upgrade Program

```bash
# Build new version
anchor build

# Upgrade deployed program on devnet
anchor upgrade <PROGRAM_ID> --provider.cluster devnet

# Verify upgrade
solana program show <PROGRAM_ID>
```

<Info>
**Devnet Testing**: Use devnet to test program upgrades before considering mainnet deployment in the future.
</Info>

### 2. Update IDL

```bash
# Update IDL after program upgrade
anchor idl upgrade <PROGRAM_ID> --filepath target/idl/aetherlock.json
```

### 3. Close Program (if needed)

```bash
# Close program and recover rent (IRREVERSIBLE)
solana program close <PROGRAM_ID> --recipient <RECIPIENT_ADDRESS>
```

<Warning>
**Irreversible Action**: Closing a program is permanent. Only do this if you're certain you no longer need the program.
</Warning>

## Common Build Errors and Fixes

### Error: "Program ID mismatch"

**Cause**: Program ID in code doesn't match keypair

**Fix**:
```bash
# Get correct program ID
solana-keygen pubkey target/deploy/aetherlock-keypair.json

# Update lib.rs with correct ID
# Update Anchor.toml with correct ID
```

### Error: "Insufficient funds"

**Cause**: Not enough SOL for deployment

**Fix**:
```bash
# Check balance
solana balance

# Airdrop more SOL on devnet
solana airdrop 10

# If airdrop fails, try smaller amounts
solana airdrop 2

# Or use a devnet faucet: https://solfaucet.com
```

### Error: "Program size too large"

**Cause**: Compiled program exceeds size limits

**Fix**:
```bash
# Optimize build
cargo build-bpf --release

# Remove debug symbols
strip target/deploy/aetherlock.so

# Check dependencies for bloat
cargo tree
```

### Error: "Account not found"

**Cause**: Program not deployed or wrong cluster

**Fix**:
```bash
# Verify cluster configuration
solana config get

# Check program exists on cluster
solana program show <PROGRAM_ID>

# Deploy if not found
anchor deploy
```

### Error: "Anchor version mismatch"

**Cause**: Different Anchor versions between build and runtime

**Fix**:
```bash
# Check Anchor version
anchor --version

# Update Anchor.toml version
[toolchain]
anchor_version = "0.29.0"

# Rebuild
anchor build
```

### Error: "BPF loader error"

**Cause**: Program binary corruption or invalid format

**Fix**:
```bash
# Clean and rebuild
anchor clean
cargo clean
anchor build

# Verify binary integrity
file target/deploy/aetherlock.so
```

## Security Considerations

### 1. Program Authority

```bash
# Set program upgrade authority
solana program set-upgrade-authority <PROGRAM_ID> <NEW_AUTHORITY>

# Check current upgrade authority
solana program show <PROGRAM_ID> | grep "Upgrade Authority"
```

<Warning>
**Devnet Security**: While devnet is for testing, still follow security best practices to prepare for future mainnet deployment.
</Warning>

### 2. Keypair Security

```bash
# Secure program keypair
chmod 600 target/deploy/aetherlock-keypair.json

# Backup keypair securely
cp target/deploy/aetherlock-keypair.json ~/secure-backups/
```

### 3. Deployment Verification

```bash
# Verify program hash matches source
anchor verify <PROGRAM_ID>

# Check program upgrade authority
solana program show <PROGRAM_ID> | grep "Upgrade Authority"
```

## Monitoring and Maintenance

### 1. Program Monitoring

```bash
# Monitor program logs
solana logs <PROGRAM_ID> --follow

# Check program account info
solana account <PROGRAM_ID>

# Monitor transaction volume
solana transaction-history <PROGRAM_ID>
```

### 2. Performance Metrics

```bash
# Check compute unit usage
solana logs <PROGRAM_ID> | grep "consumed"

# Monitor rent exemption
solana rent <ACCOUNT_SIZE>
```

### 3. Backup and Recovery

```bash
# Backup program binary
cp target/deploy/aetherlock.so backups/aetherlock-v1.0.0.so

# Backup program keypair
cp target/deploy/aetherlock-keypair.json backups/

# Backup IDL
cp target/idl/aetherlock.json backups/
```

## Next Steps

After successful devnet deployment:

1. **Update Frontend**: Configure frontend to use devnet program ID
2. **Update Backend**: Update backend services with devnet program ID
3. **Test Integration**: Run end-to-end tests with deployed devnet program
4. **Monitor Performance**: Set up monitoring and alerting for devnet
5. **Document Changes**: Update deployment documentation with actual program IDs

<Info>
**Devnet Environment**: Remember that devnet is a testing environment. Data may be reset periodically, and performance may differ from mainnet.
</Info>

For frontend and backend configuration, see:
- [Frontend Setup Guide](/implementation/frontend-setup)
- [Backend Setup Guide](/implementation/backend-setup)
- [Environment Variables Reference](/implementation/environment-variables)

## Future Mainnet Deployment

AetherLock is currently in active development. Mainnet deployment is planned for a future release after:
- Comprehensive security audits
- Extended devnet testing period
- Community feedback integration
- Production-ready infrastructure setup

Stay tuned for updates on mainnet deployment timeline.